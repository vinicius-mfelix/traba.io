name: GitHub Actions Dev Environment
on: [push]
jobs:
  Build-Application:
    runs-on: [debian-runner]
    env:
      JAR_FILE: startupone-0.0.1-SNAPSHOT.jar
      DIST_DIR: /home/admin/projects/dist/back-end/dev
      BACK_END_DIR: /home/admin/projects/source-code/back-end/startupone-backend
      JAR_FILE_DIR: /home/admin/projects/source-code/back-end/startupone-backend/target
    steps:
      - name: Install Maven Artifact
        working-directory: ${{ env.BACK_END_DIR }}
        run: |
            echo "ðŸŽ¯ DEV ENVIRONMENT RUNNING"
            echo "ðŸ§­ Running on ${{ runner.os }} - AWS Hosted VM"
            git checkout dev
            echo "ðŸ›  Installing Maven dependency..."
            ./mvnw clean install
      - name: Build Maven Artifact Package
        working-directory: ${{ env.BACK_END_DIR }}
        run: |
            echo "ðŸŽ¯ DEV ENVIRONMENT RUNNING"
            echo "ðŸ§­ Running on ${{ runner.os }} - AWS Hosted VM"
            git checkout dev
            echo "ðŸ›  Building Maven package..."
            ./mvnw clean package
      - name: Clean Dist Directory
        working-directory: ${{ env.DIST_DIR }}
        run: |
            echo "ðŸŽ¯ DEV ENVIRONMENT RUNNING"
            echo "ðŸ§­ Running on ${{ runner.os }} - AWS Hosted VM"
            echo "ðŸ§¹ Cleaning Dist Directory..."
            rm -rf *
      - name: Copy Files to Dist Directory
        working-directory: ${{ env.JAR_FILE_DIR }}
        run: |
            echo "ðŸŽ¯ DEV ENVIRONMENT RUNNING"
            echo "ðŸ§­ Running on ${{ runner.os }} - AWS Hosted VM"
            echo "ðŸ’¾ Copying files to the dist directory..."
            git checkout dev
            cp ${{ env.JAR_FILE }} ${{ env.DIST_DIR }}
      - name: Publish Tomcat Service
        working-directory: ${{ env.DIST_DIR }}
        run: |
            echo "ðŸŽ¯ DEV ENVIRONMENT RUNNING"
            echo "ðŸ§­ Running on ${{ runner.os }} - AWS Hosted VM"
            echo "ðŸ“¬ Publishing Server..."
            sudo chown admin ${{ env.JAR_FILE }}
            sudo chmod 500 ${{ env.JAR_FILE }}
            sudo systemctl restart startupone-backend-dev.service
            sudo systemctl status startupone-backend-dev.service
